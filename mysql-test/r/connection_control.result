
######## Create test users with/without ALL PRIVILEGS ########
CREATE USER user1@localhost;
CREATE USER user2@localhost;
CREATE USER user3@localhost;
CREATE USER user4@localhost;
GRANT SUPER ON *.* TO user1@localhost;
GRANT PROCESS ON *.* TO user2@localhost;
GRANT CONNECTION_ADMIN ON *.* TO user3@localhost;
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, SHUTDOWN, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE, CREATE ROLE, DROP ROLE ON *.* TO user4@localhost WITH GRANT OPTION;
GRANT ALLOW_NONEXISTENT_DEFINER,APPLICATION_PASSWORD_ADMIN,AUDIT_ABORT_EXEMPT,AUDIT_ADMIN,AUTHENTICATION_POLICY_ADMIN,BACKUP_ADMIN,BINLOG_ADMIN,BINLOG_ENCRYPTION_ADMIN,CLONE_ADMIN,ENCRYPTION_KEY_ADMIN,FIREWALL_EXEMPT,FLUSH_OPTIMIZER_COSTS,FLUSH_PRIVILEGES,FLUSH_STATUS,FLUSH_TABLES,FLUSH_USER_RESOURCES,GROUP_REPLICATION_ADMIN,GROUP_REPLICATION_STREAM,INNODB_REDO_LOG_ARCHIVE,INNODB_REDO_LOG_ENABLE,OPTIMIZE_LOCAL_TABLE,PASSWORDLESS_USER_ADMIN,PERSIST_RO_VARIABLES_ADMIN,REPLICATION_APPLIER,REPLICATION_SLAVE_ADMIN,RESOURCE_GROUP_ADMIN,RESOURCE_GROUP_USER,ROLE_ADMIN,SENSITIVE_VARIABLES_OBSERVER,SERVICE_CONNECTION_ADMIN,SESSION_VARIABLES_ADMIN,SET_ANY_DEFINER,SHOW_ROUTINE,SYSTEM_USER,SYSTEM_VARIABLES_ADMIN,TABLE_ENCRYPTION_ADMIN,TELEMETRY_LOG_ADMIN,TRANSACTION_GTID_TAG,XA_RECOVER_ADMIN ON *.* TO user4@localhost WITH GRANT OPTION;
INSTALL PLUGIN CONNECTION_CONTROL SONAME 'connection_control.so';
INSTALL PLUGIN CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS SONAME 'connection_control.so';
SET GLOBAL connection_control_failed_connections_threshold=1;
SET GLOBAL connection_control_max_connection_delay=2000;
select user(),current_user();
user()	current_user()
user1@localhost	user1@localhost
select * from information_schema.CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS;
USERHOST	FAILED_ATTEMPTS
select user(),current_user();
user()	current_user()
user2@localhost	user2@localhost
select * from information_schema.CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS;
USERHOST	FAILED_ATTEMPTS
'user'@'localhost'	3
select user(),current_user();
user()	current_user()
user3@localhost	user3@localhost
select * from information_schema.CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS;
USERHOST	FAILED_ATTEMPTS
'user'@'localhost'	3
select user(),current_user();
user()	current_user()
user4@localhost	user4@localhost
select * from information_schema.CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS;
USERHOST	FAILED_ATTEMPTS
DROP USER user1@localhost;
DROP USER user2@localhost;
DROP USER user3@localhost;
DROP USER user4@localhost;
UNINSTALL PLUGIN CONNECTION_CONTROL;
UNINSTALL PLUGIN CONNECTION_CONTROL_FAILED_LOGIN_ATTEMPTS;
